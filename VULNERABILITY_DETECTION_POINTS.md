# OWASP 취약점 탐지 포인트 분석

## A03 - Injection 취약점 탐지 포인트

### SQL Injection 탐지
**탐지 방식**: 정규표현식 패턴 매칭 + AST 분석

#### 탐지 패턴
- **문자열 연결**: `SELECT * FROM users WHERE name='` + username
- **F-string 포맷팅**: `f"SELECT * FROM users WHERE id={user_id}"`
- **execute() 함수**: `cursor.execute("SELECT..." + variable)`
- **쿼리 변수 할당**: `query = "SELECT..." + user_input`

#### 분석 포인트
- SQL 키워드 (SELECT, INSERT, UPDATE, DELETE, DROP, CREATE)와 사용자 입력 결합 패턴
- 데이터베이스 실행 함수 (`cursor.execute`, `execute`) 사용 시 동적 쿼리 생성
- Python AST 분석으로 f-string 내부의 변수명 검사 (`query` 포함 시 고위험)

### XSS (Cross-Site Scripting) 탐지
**탐지 방식**: 정규표현식 패턴 매칭 (JavaScript/TypeScript 전용)

#### 탐지 패턴
- **DOM 조작**: `innerHTML = user_input`
- **문서 작성**: `document.write()`, `document.writeln()`
- **HTML 삽입**: `insertAdjacentHTML()`, `outerHTML`
- **jQuery 메서드**: `.html()`, `.append()`

#### 분석 포인트
- 사용자 입력이 직접 DOM에 삽입되는 패턴
- 문자열 연결 (`+`) 연산자와 함께 사용되는 DOM 조작 함수
- 높은 신뢰도: `innerHTML`, `document.write` (95% 신뢰도)

### Command Injection 탐지
**탐지 방식**: 정규표현식 패턴 매칭 + 위험 함수 목록

#### 탐지 패턴
- **Python**: `os.system()`, `subprocess.*`, `eval()`, `exec()`
- **JavaScript**: `eval()`, `Function()` 생성자
- **Java**: `Runtime.getRuntime().exec()`, `ProcessBuilder`
- **C/C++**: `system()`, `popen()`, `execl()`, `execv()`

#### 분석 포인트
- 시스템 명령 실행 함수와 사용자 입력 결합
- `eval()`, `exec()` 사용 시 CRITICAL 등급 부여
- AST 분석으로 위험한 함수 호출 탐지

---

## A06 - Vulnerable Components 취약점 탐지 포인트

### 취약한 종속성 탐지
**탐지 방식**: 취약점 데이터베이스 매칭 + 버전 비교

#### 지원 파일 형식
- **Python**: `requirements.txt`
- **Node.js**: `package.json` (dependencies, devDependencies)
- **Java**: `pom.xml` (Maven 종속성)
- **Ruby**: `Gemfile`
- **PHP**: `composer.json`

#### 탐지 포인트
- **알려진 CVE**: 내장 취약점 DB와 패키지명/버전 매칭
- **심각도 분류**: CVE 정보 기반 CRITICAL/HIGH/MEDIUM/LOW 분류
- **버전 파싱**: 정규표현식으로 패키지명과 버전 추출

#### 취약점 DB 포함 패키지
- **Django**: CVE-2019-14232 (SQL Injection), CVE-2020-9402
- **Lodash**: CVE-2021-23337 (Command Injection), CVE-2020-8203 (Prototype Pollution)
- **Spring**: CVE-2022-22965 (Spring4Shell), CVE-2022-22950
- **Log4j**: CVE-2021-44228 (Log4Shell), CVE-2021-45046
- **Jackson**: CVE-2020-36518, CVE-2019-20330 (역직렬화)

### 오래된 종속성 탐지
**탐지 방식**: 최신 버전과 비교하여 버전 차이 계산

#### 분석 포인트
- **버전 비교**: Semantic Versioning 기반 버전 비교 알고리즘
- **심각도 결정**: 
  - 5개 버전 이상 뒤처짐: MEDIUM
  - 10개 버전 이상 뒤처짐: HIGH
- **최신 버전 DB**: 주요 패키지들의 최신 안정 버전 정보 보유

---

## A07 - Authentication Failures 취약점 탐지 포인트

### 하드코딩된 자격증명 탐지
**탐지 방식**: 정규표현식 패턴 매칭 + AST 분석 + 엔트로피 분석

#### 탐지 패턴
- **변수 할당**: `password = "admin123"`, `api_key = "secret"`
- **설정 파일**: `PASSWORD = "default"`, `SECRET_KEY = "test"`
- **약한 자격증명**: admin, password, 123, test, root, guest, default

#### 분석 포인트
- **엔트로피 분석**: Shannon 엔트로피 < 3.0 시 약한 자격증명으로 판단
- **길이 검사**: 6자 미만 자격증명은 HIGH 위험도
- **키워드 매칭**: 약한 자격증명 키워드 리스트와 비교
- **Python AST**: 변수 할당문에서 credential 관련 변수명 검사

### 약한 암호화 알고리즘 탐지
**탐지 방식**: 정규표현식 패턴 매칭

#### 탐지 패턴
- **Python**: `hashlib.md5()`, `hashlib.sha1()`
- **Java**: `MessageDigest.getInstance("MD5"/"SHA1")`
- **JavaScript**: `crypto.createHash("md5"/"sha1")`

#### 분석 포인트
- **MD5 사용**: HIGH 위험도 (매우 약한 해시)
- **SHA1 사용**: MEDIUM 위험도 (약한 해시)
- **권장사항**: SHA-256, bcrypt, scrypt 사용 권고

### 안전하지 않은 세션 설정 탐지
**탐지 방식**: 정규표현식 패턴 매칭

#### 탐지 패턴
- **Flask**: `session.permanent = False`
- **Django**: `SESSION_COOKIE_SECURE = False`, `SESSION_COOKIE_HTTPONLY = False`
- **일반**: `session_cookie_secure = False`

#### 분석 포인트
- **Secure Flag**: HTTPS에서만 쿠키 전송 보장
- **HttpOnly Flag**: JavaScript에서 쿠키 접근 방지
- **Session Permanence**: 세션 지속성 설정

### JWT 약한 비밀키 탐지
**탐지 방식**: 정규표현식 패턴 매칭 (JavaScript/TypeScript)

#### 탐지 패턴
- **JWT 서명**: `jwt.sign(payload, "weak_secret")`
- **짧은 비밀키**: 10자 이하 비밀키 사용

#### 분석 포인트
- **비밀키 길이**: 충분한 엔트로피를 위한 길이 검증
- **하드코딩**: 소스코드 내 JWT 비밀키 하드코딩 탐지

---

## 공통 분석 기법

### 1. 정규표현식 패턴 매칭
- 빠른 스캔 속도
- 다양한 프로그래밍 언어 지원
- 패턴 기반 취약점 탐지

### 2. AST (Abstract Syntax Tree) 분석
- Python 코드의 구문 분석
- 정확한 함수 호출 및 변수 할당 탐지
- 더 정확한 컨텍스트 이해

### 3. 신뢰도 점수 계산
- 패턴별 신뢰도 차등 부여
- 컨텍스트 기반 신뢰도 조정
- 거짓 양성(False Positive) 최소화

### 4. 심각도 분류
- **CRITICAL**: 즉시 수정 필요 (eval, exec, Log4Shell 등)
- **HIGH**: 높은 위험도 (SQL Injection, 약한 자격증명)
- **MEDIUM**: 중간 위험도 (XSS, 세션 설정)
- **LOW**: 낮은 위험도 (오래된 패키지)

### 5. CWE (Common Weakness Enumeration) 매핑
- **CWE-89**: SQL Injection
- **CWE-79**: Cross-Site Scripting
- **CWE-78**: Command Injection
- **CWE-798**: Hardcoded Credentials
- **CWE-327**: Weak Cryptography
- **CWE-937**: Vulnerable Components